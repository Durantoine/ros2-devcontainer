services:
  ros2:
    platform: linux/arm64
    build:
      context: .
      dockerfile: Dockerfile
    image: local/ros2-m3:latest
    container_name: ros2_dev
    stdin_open: true
    tty: true
    ports:
      - "5900:5900"  # VNC port
      - "6080:6080"  # noVNC web interface
    environment:
      - DISPLAY=:0
      - QT_X11_NO_MITSHM=1
      - ROS_DOMAIN_ID=0
    volumes:
      # Mount only specific files/folders to avoid duplication
      - ./workspaces:/workspaces
      - ./workspace_helpers.sh:/workspace_helpers.sh
      - ./.devcontainer:/root/.devcontainer
    command: sleep infinity
    networks:
      - ros2_network

networks:
  ros2_network:
    driver: bridge
